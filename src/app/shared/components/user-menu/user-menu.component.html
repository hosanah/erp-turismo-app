<div class="relative">
  <!-- Replaced pButton and p-avatar with mat-icon-button and a styled div for initials -->
  <button mat-icon-button 
          [matMenuTriggerFor]="userMenu" 
          aria-label="User menu"
          class="h-8 w-8 rounded-full flex items-center justify-center text-sm font-medium"
          [style.background-color]="company?.primaryColor || 'var(--primary)'"
          [style.color]="'var(--app-on-primary)'"> 
    {{ userInitials }}
  </button>

  <!-- Replaced p-menu with mat-menu -->
  <mat-menu #userMenu="matMenu" xPosition="before" class="dark:bg-gray-800 dark:border dark:border-gray-700">
    <!-- Iterate through MaterialMenuItem structure -->
    <ng-template ngFor let-item [ngForOf]="menuItems">
      <!-- Handle separator -->
      <mat-divider *ngIf="item.separator"></mat-divider>
      
      <!-- Handle regular menu item -->
      <button mat-menu-item 
              *ngIf="!item.separator" 
              (click)="handleMenuClick(item)" 
              class="dark:text-gray-200 dark:hover:bg-gray-700">
        <mat-icon>{{ item.icon }}</mat-icon>
        <span>{{ item.label }}</span>
      </button>
    </ng-template>
  </mat-menu>
</div>

